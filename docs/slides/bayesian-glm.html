<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.32">

  <meta name="author" content="Filippo Gambarota">
  <title>Introduction to Bayesian Statistics – Generalized Linear Models with brms</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
    /* CSS for citations */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
      margin-bottom: 0em;
    }
    .hanging-indent div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-33a8f69d27d0d9510d382f0da0d9a1c6.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="center">
    <h1 class="title">Generalized Linear Models with <code>brms</code></h1>
        <p class="author">Filippo Gambarota</p>
        </section>
<section>
<section id="recap-about-linear-models" class="title-slide slide level1 center">
<h1>Recap about linear models</h1>

</section>
<section id="almost-everything-is-a-linear-model" class="slide level2">
<h2>(almost) everything is a linear model</h2>
<p>Most of the statistical analysis that you usually perfom, is essentially a linear model.</p>
<ul>
<li>The <strong>t-test</strong> is a linear model where a numerical variable <code>y</code> is predicted by a factor with two levels <code>x</code></li>
<li>The <strong>one-way anova</strong> is a linear model where a numerical variable <code>y</code> is predicted by one factor with more than two levels <code>x</code></li>
<li>The <strong>correlation</strong> is a linear model where a numerical variable <code>y</code> is predicted by another numerical variable <code>x</code></li>
<li>The <strong>ancova</strong> is a linear model where a numerical variable <code>y</code> is predicted by a numerical variable <code>x</code> and a factor with two levels <code>g</code></li>
<li>…</li>
</ul>
</section>
<section id="what-is-a-linear-model" class="slide level2">
<h2>What is a linear model?</h2>
<p>Let’s start with a single variable <code>y</code>. We assume that the variable comes from a Normal distribution:</p>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-3-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="what-is-a-linear-model-1" class="slide level2">
<h2>What is a linear model?</h2>
<p>What we can do with this variable? We can estimate the parameters that define the Normal distribution thus <span class="math inline">\(\mu\)</span> (the mean) and <span class="math inline">\(\sigma\)</span> (the standard deviation).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(y)</span>
<span id="cb1-2"><a aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 100</span></span>
<span id="cb1-3"><a aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(y)</span>
<span id="cb1-4"><a aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 50</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="what-is-a-linear-model-2" class="slide level2">
<h2>What is a linear model?</h2>
<p>Using a linear model we can just fit a model without predictors, also known as intercept-only model.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> <span class="dv">1</span>, <span class="at">family =</span> <span class="fu">gaussian</span>(<span class="at">link =</span> <span class="st">"identity"</span>))</span>
<span id="cb2-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; glm(formula = y ~ 1, family = gaussian(link = "identity"))
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    
#&gt; (Intercept)      100          5      20   &lt;2e-16 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; (Dispersion parameter for gaussian family taken to be 2500)
#&gt; 
#&gt;     Null deviance: 247500  on 99  degrees of freedom
#&gt; Residual deviance: 247500  on 99  degrees of freedom
#&gt; AIC: 1069.2
#&gt; 
#&gt; Number of Fisher Scoring iterations: 2</code></pre>
</div>
</div>
</section>
<section id="what-is-a-linear-model-3" class="slide level2">
<h2>What is a linear model?</h2>
<p>I am using <code>glm</code> because I want to estimate parameters using Maximul Likelihood, but the results are the same as using <code>lm</code>.</p>
<p>Basically we estimated the mean <code>(Intercept)</code> and the standard deviation <code>Dispersion</code>, just take the square root thus 50.</p>
<p>What we are doing is essentially finding the <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span> that maximised the log-likelihood of the model fixing the observed data.</p>
</section>
<section id="what-is-a-linear-model-4" class="slide level2">
<h2>What is a linear model?</h2>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-6-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="what-is-a-linear-model-5" class="slide level2">
<h2>What is a linear model?</h2>
<p>And assuming that we know <span class="math inline">\(\sigma\)</span> (thus fixing it at 50):</p>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-7-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="what-is-a-linear-model-6" class="slide level2">
<h2>What is a linear model?</h2>
<p>Thus, with the estimates of <code>glm</code>, we have this model fitted on the data:</p>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-8-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="including-a-predictor" class="slide level2">
<h2>Including a predictor</h2>
<p>When we include a predictor, we are actually try to explain the variability of <code>y</code> using a variable <code>x</code>. For example, this is an hypothetical relationship:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-9-1.svg" class="quarto-figure quarto-figure-center" width="960"></p>
</figure>
</div>
</div>
</div>
<p>Seems that there is a positive (linear) relationship between <code>x</code> and <code>y</code>. We can try to improve the previous model by adding the predictor:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> x, <span class="at">family =</span> <span class="fu">gaussian</span>(<span class="at">link =</span> <span class="st">"identity"</span>))</span>
<span id="cb4-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; glm(formula = y ~ x, family = gaussian(link = "identity"))
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    
#&gt; (Intercept)  9.93465    0.09996  99.383  &lt; 2e-16 ***
#&gt; x            0.36029    0.08750   4.118 7.99e-05 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; (Dispersion parameter for gaussian family taken to be 0.9971643)
#&gt; 
#&gt;     Null deviance: 114.629  on 99  degrees of freedom
#&gt; Residual deviance:  97.722  on 98  degrees of freedom
#&gt; AIC: 287.48
#&gt; 
#&gt; Number of Fisher Scoring iterations: 2</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-11-1.svg" class="quarto-figure quarto-figure-center" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="assumptions-of-the-linear-model" class="slide level2">
<h2>Assumptions of the linear model</h2>
<p>More practicaly, we are saying that the model allows for varying the mean i.e., each <code>x</code> value can be associated with a different <span class="math inline">\(\mu\)</span> but with a fixed (and estimated) <span class="math inline">\(\sigma\)</span>.</p>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-12-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section></section>
<section>
<section id="generalized-linear-models" class="title-slide slide level1 center">
<h1>Generalized linear models</h1>

</section>
<section id="recipe-for-a-glm" class="slide level2">
<h2>Recipe for a GLM</h2>
<ul>
<li><strong>Random Component</strong></li>
<li><strong>Systematic Component</strong></li>
<li><strong>Link Function</strong></li>
</ul>
</section>
<section id="random-component" class="slide level2">
<h2>Random Component</h2>
<p>The <strong>random component</strong> of a GLM identify the response variable <span class="math inline">\(y\)</span> coming from a certain probability distribution.</p>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-13-1.svg" class="quarto-figure quarto-figure-center r-stretch" style="width:50.0%"></section>
<section id="random-component-1" class="slide level2">
<h2>Random Component</h2>
<ul>
<li>In practice, by definition the GLM is a model where the random component is a distribution of the <a href="https://en.wikipedia.org/wiki/Exponential_family">Exponential Family</a>. For example the Gaussian distribution, the Gamma distribution or the Binomial are part of the Exponential Family.</li>
<li>These distribution can be described using a <strong>location</strong> parameter (e.g., the mean) and a <strong>scale</strong> parameter (e.g., the variance).</li>
<li>The distributions are defined by parameters (e.g., <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span> for the Gaussian or <span class="math inline">\(\lambda\)</span> for the Poisson). The location (or mean) can be directly one of the parameter or a combination of parameters.</li>
</ul>
</section>
<section id="random-component-poisson-example" class="slide level2">
<h2>Random Component, Poisson example</h2>
<p>For example, the <a href="https://it.wikipedia.org/wiki/Distribuzione_di_Poisson">Poisson distribution</a> is defined as:</p>
<p><span class="math display">\[
f(k,\lambda) = Pr(X = k) = \frac{\lambda^k e^{-\lambda}}{k!}
\]</span></p>
<p>Where <span class="math inline">\(k\)</span> is the number of events and <span class="math inline">\(\lambda\)</span> (the only parameter) is the <em>rate</em>.</p>
</section>
<section id="random-component-poisson-example-1" class="slide level2">
<h2>Random Component, Poisson example</h2>
<p>The mean or location of the Poisson is <span class="math inline">\(\lambda\)</span> and also the scale or variance is <span class="math inline">\(\lambda\)</span>. Compared to the Gaussian, there are no two parameters.</p>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-14-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="random-component-2" class="slide level2">
<h2>Random Component</h2>
<p>To sum-up, the random component represents the assumption about the nature of our response variable. <strong>With GLM we want to include predictors to explain <em>systematic</em> changes of the mean (but also the scale/variance) of the random component</strong>.</p>
<p>Assuming a Gaussian distribution, we try to explain how the mean of the Gaussian distribution change according to our predictors. For the Poisson, we include predictors on the <span class="math inline">\(\lambda\)</span> parameters for example.</p>
<p>The Random Component is called random, beacause it determines how the <strong>error term</strong> <span class="math inline">\(\epsilon\)</span> of our model is distributed.</p>
</section>
<section id="systematic-component" class="slide level2">
<h2>Systematic Component</h2>
<p>The systematic component of a GLM is the combination of predictors (i.e., independent variables) that we want to include in the model.</p>
<p>The systematic component is also called <em>linear predictor</em> <span class="math inline">\(\eta\)</span> and is usually written in equation terms as: <span class="math display">\[
\eta_i = \beta_0 + \beta_1 x_{i1} + \beta_2 x_{i2} + \cdots + \beta_p x_{ip}
\]</span></p>
<p>Note that I am omitting the <span class="math inline">\(+ \epsilon_i\)</span> that you usually find at the end because this is the combination of predictors without errors.</p>
</section>
<section id="systematic-component-an-example" class="slide level2">
<h2>Systematic Component, an example</h2>
<p>Assuming that we have two groups and we want to see if there are differences in a depression score. This is a t-test, or better a linear model, or better a GLM.</p>
<p>Ignoring the random component, we can have a systematic component written in this way:</p>
<p><span class="math display">\[
\eta_i = \beta_0 + \beta_1{\mbox{group}_i}
\]</span></p>
<p>Assuming that the group is dummy-coded, <span class="math inline">\(\beta_0\)</span> is the mean of the first group and <span class="math inline">\(\beta_1\)</span> is the difference between the two groups. In other terms, these are the true or estimated values without the error (i.e., the random component).</p>
</section>
<section id="systematic-component-an-example-1" class="slide level2">
<h2>Systematic Component, an example</h2>
<p>Another example, assuming we have the same depression score and we want to predict it with an anxiety score. The blue line is the true/estimated regression line where <span class="math inline">\(\eta_i\)</span> is the expected value for the observation <span class="math inline">\(x_i\)</span>. The red segments are the errors or residuals i.e., the random component.</p>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-15-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="systematic-component-1" class="slide level2">
<h2>Systematic Component</h2>
<p>To sum-up, the systematic component is the combination of predictors that are used to predict the mean of the distribution that is used as random component. The errors part of the model is distributed as the random component.</p>
</section>
<section id="link-function" class="slide level2">
<h2>Link Function</h2>
<p>The final element is the <strong>link function</strong>. The idea is that we need a way to connect the systematic component <span class="math inline">\(\eta\)</span> to the random component mean <span class="math inline">\(\mu\)</span>.</p>
<p>The <strong>link function</strong> <span class="math inline">\(g(\mu)\)</span> is an <strong>invertible</strong> function that connects the mean <span class="math inline">\(\mu\)</span> of the random component with the <em>linear combination</em> of predictors.</p>
<p>Thus <span class="math inline">\(\eta_i = g(\mu_i)\)</span> and <span class="math inline">\(\mu_i = g(\eta_i)^{-1}\)</span>. The systematic component is not affected by <span class="math inline">\(g()\)</span> while the relationship between <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\eta\)</span> changes using different link functions.</p>
<p><span class="math display">\[
g(\mu_i) = \eta_i = \beta_0 + \beta_1 x_{i1} + \beta_2 x_{i2} + \cdots + \beta_p x_{ip}
\]</span></p>
<p><span class="math display">\[
\mu_i = g(\eta_i)^{-1} = \eta_i = \beta_0 + \beta_1 x_{i1} + \beta_2 x_{i2} + \cdots + \beta_p x_{ip}
\]</span></p>
</section>
<section id="link-function-1" class="slide level2">
<h2>Link function</h2>
<p>The simplest <strong>link function</strong> is the <strong>identity link</strong> where <span class="math inline">\(g(\mu) = \mu\)</span> and correspond to the standard linear model. In fact, the linear regression is just a GLM with a <strong>Gaussian random component</strong> and the <strong>identity</strong> link function.</p>
<div class="cell" data-layout-align="center" data-tbl-cap="Main distributions and link functions">
<div class="cell-output-display">
<div id="kvpdbzsuax" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#kvpdbzsuax table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#kvpdbzsuax thead, #kvpdbzsuax tbody, #kvpdbzsuax tfoot, #kvpdbzsuax tr, #kvpdbzsuax td, #kvpdbzsuax th {
  border-style: none;
}

#kvpdbzsuax p {
  margin: 0;
  padding: 0;
}

#kvpdbzsuax .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#kvpdbzsuax .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#kvpdbzsuax .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#kvpdbzsuax .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#kvpdbzsuax .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kvpdbzsuax .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kvpdbzsuax .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kvpdbzsuax .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#kvpdbzsuax .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#kvpdbzsuax .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#kvpdbzsuax .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#kvpdbzsuax .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#kvpdbzsuax .gt_spanner_row {
  border-bottom-style: hidden;
}

#kvpdbzsuax .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#kvpdbzsuax .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#kvpdbzsuax .gt_from_md > :first-child {
  margin-top: 0;
}

#kvpdbzsuax .gt_from_md > :last-child {
  margin-bottom: 0;
}

#kvpdbzsuax .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#kvpdbzsuax .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#kvpdbzsuax .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#kvpdbzsuax .gt_row_group_first td {
  border-top-width: 2px;
}

#kvpdbzsuax .gt_row_group_first th {
  border-top-width: 2px;
}

#kvpdbzsuax .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kvpdbzsuax .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#kvpdbzsuax .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#kvpdbzsuax .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kvpdbzsuax .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kvpdbzsuax .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#kvpdbzsuax .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#kvpdbzsuax .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#kvpdbzsuax .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kvpdbzsuax .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kvpdbzsuax .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kvpdbzsuax .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kvpdbzsuax .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kvpdbzsuax .gt_left {
  text-align: left;
}

#kvpdbzsuax .gt_center {
  text-align: center;
}

#kvpdbzsuax .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#kvpdbzsuax .gt_font_normal {
  font-weight: normal;
}

#kvpdbzsuax .gt_font_bold {
  font-weight: bold;
}

#kvpdbzsuax .gt_font_italic {
  font-style: italic;
}

#kvpdbzsuax .gt_super {
  font-size: 65%;
}

#kvpdbzsuax .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#kvpdbzsuax .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#kvpdbzsuax .gt_indent_1 {
  text-indent: 5px;
}

#kvpdbzsuax .gt_indent_2 {
  text-indent: 10px;
}

#kvpdbzsuax .gt_indent_3 {
  text-indent: 15px;
}

#kvpdbzsuax .gt_indent_4 {
  text-indent: 20px;
}

#kvpdbzsuax .gt_indent_5 {
  text-indent: 25px;
}

#kvpdbzsuax .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#kvpdbzsuax div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<caption>Main distributions and link functions</caption>
<thead>
<tr class="gt_col_headings header">
<th id="Family" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Family</th>
<th id="Link" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Link</th>
<th id="Range" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Range</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center" headers="Family"><code>gaussian</code></td>
<td class="gt_row gt_center" headers="Link">identity</td>
<td class="gt_row gt_center" headers="Range"><span class="math display">\[(-\infty,+\infty)\]</span></td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="Family"><code>gamma</code></td>
<td class="gt_row gt_center" headers="Link">log</td>
<td class="gt_row gt_center" headers="Range"><span class="math display">\[(0,+\infty)\]</span></td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="Family"><code>binomial</code></td>
<td class="gt_row gt_center" headers="Link">logit</td>
<td class="gt_row gt_center" headers="Range"><span class="math display">\[\frac{0, 1, ..., n_{i}}{n_{i}}\]</span></td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="Family"><code>binomial</code></td>
<td class="gt_row gt_center" headers="Link">probit</td>
<td class="gt_row gt_center" headers="Range"><span class="math display">\[\frac{0, 1, ..., n_{i}}{n_{i}}\]</span></td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="Family"><code>poisson</code></td>
<td class="gt_row gt_center" headers="Link">log</td>
<td class="gt_row gt_center" headers="Range"><span class="math display">\[0, 1, 2, ...\]</span></td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="gaussian-glm" class="slide level2">
<h2>Gaussian GLM</h2>
<p>Thus remember that when you do a <code>lm</code> or <code>lmer</code> you are actually doing a GLM with a Gaussian random component and an identity link function. You are including predictors (systematic component) explaining changes in the mean of the Gaussian distribution.</p>
<div class="columns">
<div class="column">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; lm(formula = y ~ x)
#&gt; 
#&gt; Coefficients:
#&gt; (Intercept)            x  
#&gt;      0.2368       0.3688</code></pre>
</div>
</div>
</div><div class="column">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">glm</span>(y <span class="sc">~</span> x, <span class="at">family =</span> <span class="fu">gaussian</span>(<span class="at">link =</span> <span class="st">"identity"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:  glm(formula = y ~ x, family = gaussian(link = "identity"))
#&gt; 
#&gt; Coefficients:
#&gt; (Intercept)            x  
#&gt;      0.2368       0.3688  
#&gt; 
#&gt; Degrees of Freedom: 99 Total (i.e. Null);  98 Residual
#&gt; Null Deviance:       109.6 
#&gt; Residual Deviance: 96.23     AIC: 285.9</code></pre>
</div>
</div>
</div></div>
</section>
<section id="gaussian-glm-a-simple-simulation" class="slide level2">
<h2>Gaussian GLM, a simple simulation</h2>
<p>We can understand the GLM recipe trying to simulate a simple model. Let’s simulate a relationship between two numerical variables (like the depression and anxiety example).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb10-2"><a aria-hidden="true" tabindex="-1"></a>anxiety <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="dv">0</span>, <span class="dv">1</span>) <span class="co"># anxiety scores</span></span>
<span id="cb10-3"><a aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="fl">0.3</span> <span class="co"># intercept, depression when anxiety = 0</span></span>
<span id="cb10-4"><a aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="co"># increase in depression for 1 increase in anxiety</span></span>
<span id="cb10-5"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a aria-hidden="true" tabindex="-1"></a><span class="co"># systematic component</span></span>
<span id="cb10-7"><a aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> b0 <span class="sc">+</span> b1 <span class="sc">*</span> anxiety</span>
<span id="cb10-8"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(anxiety, b0, b1, eta)</span>
<span id="cb10-10"><a aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;      anxiety  b0  b1         eta
#&gt; 1  0.4892000 0.3 0.5  0.54460001
#&gt; 2 -1.5912630 0.3 0.5 -0.49563148
#&gt; 3 -0.4770213 0.3 0.5  0.06148934
#&gt; 4 -1.8916850 0.3 0.5 -0.64584248
#&gt; 5 -0.4024015 0.3 0.5  0.09879926
#&gt; 6  0.7335647 0.3 0.5  0.66678234</code></pre>
</div>
</div>
</section>
<section id="gaussian-glm-a-simple-simulation-1" class="slide level2">
<h2>Gaussian GLM, a simple simulation</h2>
<p><code>eta</code> is the linear predictor (without errors):</p>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-21-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"><p>Thus the expected value of a person with <span class="math inline">\(\mbox{anxiety} = -1\)</span> is <span class="math inline">\(\beta_0 + \beta_1\times(-1)\)</span> thus -0.2.</p>
</section>
<section id="gaussian-glm-a-simple-simulation-2" class="slide level2">
<h2>Gaussian GLM, a simple simulation</h2>
<p>Now, for a realistic simulation we need some random errors. The random component here is a Gaussian distribution thus each observed (or simulated) value is the systematic component plus the random error <span class="math inline">\(\mbox{depression}_i = \eta_i + \epsilon_i\)</span>.</p>
<p>The errors (or residuals) are assumed to be normally distributed with <span class="math inline">\(\mu = 0\)</span> and variance <span class="math inline">\(\sigma^2_{\epsilon}\)</span> (the residual standard deviation).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># residual standard deviation</span></span>
<span id="cb12-2"><a aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="dv">0</span>, sigma)</span>
<span id="cb12-3"><a aria-hidden="true" tabindex="-1"></a>depression <span class="ot">&lt;-</span> eta <span class="sc">+</span> error <span class="co"># b0 + b1 * anxiety + error</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="gaussian-glm-a-simple-simulation-3" class="slide level2">
<h2>Gaussian GLM, a simple simulation</h2>
<p>This is the simulated dataset. The blue line is the linear predictor and the red segments are the Gaussian residuals.</p>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-23-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="gaussian-glm-a-simple-simulation-4" class="slide level2">
<h2>Gaussian GLM, a simple simulation</h2>
<p>If we plot the red segments we have roughly a Gaussian distribution. This is the assumption of the GLM with a Gaussian random component.</p>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-24-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="what-about-the-link-function" class="slide level2">
<h2>What about the link function?</h2>
<p>The link function for the Gaussian GLM is by default the <em>identity</em>. Identity means that <span class="math inline">\(\eta_i = \mu_i\)</span>, thus there is no transformation. Within each distribution object in R there is the link function and the inverse:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># this is the family (or random component) and the link function. doing a lm() is like glm(family = gaussian(link = "identity"))</span></span>
<span id="cb13-2"><a aria-hidden="true" tabindex="-1"></a>fam <span class="ot">&lt;-</span> <span class="fu">gaussian</span>(<span class="at">link =</span> <span class="st">"identity"</span>)</span>
<span id="cb13-3"><a aria-hidden="true" tabindex="-1"></a>fam<span class="sc">$</span>linkfun <span class="co"># link function specifed above</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; function (mu) 
#&gt; mu
#&gt; &lt;environment: namespace:stats&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a aria-hidden="true" tabindex="-1"></a>fam<span class="sc">$</span>linkinv <span class="co"># inverse link function</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; function (eta) 
#&gt; eta
#&gt; &lt;environment: namespace:stats&gt;</code></pre>
</div>
</div>
</section>
<section id="what-about-the-link-function-1" class="slide level2">
<h2>What about the link function?</h2>
<p>With the identity, the link function has no effect.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> fam<span class="sc">$</span><span class="fu">linkinv</span>(b0 <span class="sc">+</span> b1 <span class="sc">*</span> anxiety)</span>
<span id="cb17-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mu)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1]  0.54460001 -0.49563148  0.06148934 -0.64584248  0.09879926  0.66678234</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fam<span class="sc">$</span><span class="fu">linkfun</span>(mu))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1]  0.54460001 -0.49563148  0.06148934 -0.64584248  0.09879926  0.66678234</code></pre>
</div>
</div>
<p>But with other GLMs, (e.g., logistic regression) the link function is the core element.</p>
</section>
<section id="gaussian-glm-a-simple-simulation-5" class="slide level2">
<h2>Gaussian GLM, a simple simulation</h2>
<p>A more compact (and useful) way to simulate the data is:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a aria-hidden="true" tabindex="-1"></a>depression <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="at">mean =</span> fam<span class="sc">$</span><span class="fu">linkinv</span>(b0 <span class="sc">+</span> b1 <span class="sc">*</span> anxiety), <span class="at">sd =</span> sigma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this way is more clear that we are generating data from a normal distribution with fixed <span class="math inline">\(\sigma^2_{\epsilon}\)</span> and we are modeling the mean.</p>
</section></section>
<section>
<section id="parameters-intepretation" class="title-slide slide level1 center">
<h1>Parameters intepretation</h1>

</section>
<section id="parameters-intepretation-1" class="slide level2">
<h2>Parameters intepretation</h2>
<p>Let’s make a more complex example with a Gaussian GLM with more than one predictor. We have a dataset with 150 observations and some variables.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;   depression age group    anxiety
#&gt; 1 -0.2173456  23    g1  0.0022093
#&gt; 2  0.3273544  40    g2 -0.1100926
#&gt; 3  1.0405812  24    g1  0.4261357
#&gt; 4  2.8139121  33    g2  1.8146185
#&gt; 5  0.7347837  30    g1 -0.1817395
#&gt; 6  0.6209260  26    g2 -1.2488724</code></pre>
</div>
</div>
<p>We want to predict the <code>depression</code> with <code>anxiety</code>, <code>group</code> and <code>age</code>.</p>
</section>
<section id="parameters-intepretation-2" class="slide level2">
<h2>Parameters intepretation</h2>
<p>Let’s fit the model (here using <code>lm</code> but is a GLM!):</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; lm(formula = depression ~ anxiety + group + age, data = dat)
#&gt; 
#&gt; Residuals:
#&gt;     Min      1Q  Median      3Q     Max 
#&gt; -2.0837 -0.6937 -0.1653  0.5869  3.1663 
#&gt; 
#&gt; Coefficients:
#&gt;              Estimate Std. Error t value Pr(&gt;|t|)    
#&gt; (Intercept) -0.229923   0.326055  -0.705  0.48183    
#&gt; anxiety      0.526979   0.081160   6.493 1.23e-09 ***
#&gt; groupg2      0.367025   0.165569   2.217  0.02819 *  
#&gt; age          0.024005   0.009075   2.645  0.00906 ** 
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; Residual standard error: 1.013 on 146 degrees of freedom
#&gt; Multiple R-squared:  0.2574, Adjusted R-squared:  0.2421 
#&gt; F-statistic: 16.87 on 3 and 146 DF,  p-value: 1.844e-09</code></pre>
</div>
</div>
<p>How do you intepret the output? and the model parameters?</p>
</section></section>
<section>
<section id="bayesian-models" class="title-slide slide level1 center">
<h1>Bayesian Models</h1>

</section>
<section id="bayesian-vs-frequentists-glm" class="slide level2">
<h2>Bayesian vs Frequentists GLM</h2>
<p>What about the Bayesian version of the previous model? Actually the main difference is that we need to include the priors to obtain posterior distributions about model parameters. The likelihood part is extactly the same as non-bayesian models.</p>
</section>
<section id="brms" class="slide level2">
<h2><code>brms</code></h2>
<p>There are several R packages for estimating Bayesian GLMs. The most complete is called <a href="https://paulbuerkner.com/brms/"><code>brms</code></a>.</p>
<p>There are also other options such as <code>rstanarm</code>. <code>rstanarm</code> is faster but less flexible. <code>brms</code> include all GLMs (and also other models such as meta-analysis, multivariate, etc.) but is slower and requires more knowledge.</p>
<p>The syntax is the same as <code>lm</code> or <code>glm</code> and also <code>lme4</code> if you want to include random-effects.</p>
</section>
<section id="brms-1" class="slide level2">
<h2><code>brms</code></h2>
<p>Let’s start with a simple model, predicting the <code>depression</code> with the group. Thus essentially a t-test:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a aria-hidden="true" tabindex="-1"></a>fit_group <span class="ot">&lt;-</span> <span class="fu">brm</span>(depression <span class="sc">~</span> group, </span>
<span id="cb24-2"><a aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> dat, </span>
<span id="cb24-3"><a aria-hidden="true" tabindex="-1"></a>                 <span class="at">family =</span> <span class="fu">gaussian</span>(<span class="at">link =</span> <span class="st">"identity"</span>), </span>
<span id="cb24-4"><a aria-hidden="true" tabindex="-1"></a>                 <span class="at">file =</span> <span class="fu">here</span>(<span class="st">"slides/objects/fit_group.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="brms-2" class="slide level2">
<h2><code>brms</code></h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  Family: gaussian 
#&gt;   Links: mu = identity; sigma = identity 
#&gt; Formula: depression ~ group 
#&gt;    Data: dat (Number of observations: 150) 
#&gt;   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
#&gt;          total post-warmup draws = 4000
#&gt; 
#&gt; Regression Coefficients:
#&gt;           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
#&gt; Intercept     0.56      0.13     0.31     0.82 1.00     3601     2924
#&gt; groupg2       0.44      0.18     0.08     0.80 1.00     3456     2832
#&gt; 
#&gt; Further Distributional Parameters:
#&gt;       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
#&gt; sigma     1.11      0.07     1.00     1.26 1.00     3865     2502
#&gt; 
#&gt; Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential
#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
</section>
<section id="brms-vs-lm" class="slide level2">
<h2><code>brms</code> vs <code>lm</code></h2>
<p>Firstly, let’s compare the two models:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; lm(formula = depression ~ group, data = dat)
#&gt; 
#&gt; Residuals:
#&gt;     Min      1Q  Median      3Q     Max 
#&gt; -2.7678 -0.7283 -0.1033  0.6176  3.7671 
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    
#&gt; (Intercept)   0.5795     0.1335   4.341 2.62e-05 ***
#&gt; groupg2       0.3170     0.1888   1.679   0.0952 .  
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; Residual standard error: 1.156 on 148 degrees of freedom
#&gt; Multiple R-squared:  0.0187, Adjusted R-squared:  0.01207 
#&gt; F-statistic:  2.82 on 1 and 148 DF,  p-value: 0.09521</code></pre>
</div>
</div>
</section>
<section id="brms-results" class="slide level2">
<h2><code>brms</code> results</h2>
<p>Firsly we can have a look at the posterior distributions of the parameters:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit_group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-33-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="model-checking-using-simulations" class="slide level2">
<h2>Model checking using simulations</h2>
<p>We can check the model fit using simulations. In Bayesian terms this is called Posterior Predictive Checks. For standard models we use only the likelihood.</p>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-34-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="model-checking-using-simulations-1" class="slide level2">
<h2>Model checking using simulations</h2>
<p>With the Bayesian models we can just use the <code>brms::pp_check()</code> function that compute the posterior predictive checks:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(fit_group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-35-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="setting-priors" class="slide level2">
<h2>Setting priors</h2>
<p>By default <code>brms</code> use some priors. You can see the actual used priors using:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;                   prior     class    coef group resp dpar nlpar lb ub
#&gt;                  (flat)         b                                    
#&gt;                  (flat)         b groupg2                            
#&gt;  student_t(3, 0.9, 2.5) Intercept                                    
#&gt;    student_t(3, 0, 2.5)     sigma                                0   
#&gt;        source
#&gt;       default
#&gt;  (vectorized)
#&gt;       default
#&gt;       default</code></pre>
</div>
</div>
<p>You can also see the priors before fitting the model:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;                   prior     class    coef group resp dpar nlpar lb ub
#&gt;                  (flat)         b                                    
#&gt;                  (flat)         b groupg2                            
#&gt;  student_t(3, 0.6, 2.5) Intercept                                    
#&gt;    student_t(3, 0, 2.5)     sigma                                0   
#&gt;        source
#&gt;       default
#&gt;  (vectorized)
#&gt;       default
#&gt;       default</code></pre>
</div>
</div>
</section></section>
<section>
<section id="centering-re-scaling-and-contrasts-coding" class="title-slide slide level1 center">
<h1>Centering, re-scaling and contrasts coding</h1>

</section>
<section id="centering-re-scaling-and-contrasts-coding-1" class="slide level2">
<h2>Centering, re-scaling and contrasts coding</h2>
<p>When fitting a model is important to transform the predictors according to the hypothesis that we have and the intepretation of parameters.</p>
<p>Centering (for numerical variables) and contrasts coding (for categorical variables) are the two main strategies affecting the intepretation of model parameters.</p>
<p>The crucial point is that also the prior distribution need to be adapted when using different parametrizations of the same model.</p>
</section>
<section id="rescaling" class="slide level2">
<h2>Rescaling</h2>
<p>For example, let’s assume to have the relationship between self-esteem (from 0 to 20) and the graduation mark from 66 to 111 (110 cum laude):</p>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-39-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="rescaling-1" class="slide level2">
<h2>Rescaling</h2>
<p>Let’s fit a simple regression:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  Family: gaussian 
#&gt;   Links: mu = identity; sigma = identity 
#&gt; Formula: se ~ mark 
#&gt;    Data: dat_mark (Number of observations: 30) 
#&gt;   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
#&gt;          total post-warmup draws = 4000
#&gt; 
#&gt; Regression Coefficients:
#&gt;           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
#&gt; Intercept    -7.96      2.10   -12.20    -3.85 1.00     3159     2822
#&gt; mark          0.13      0.02     0.09     0.18 1.00     3186     2813
#&gt; 
#&gt; Further Distributional Parameters:
#&gt;       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
#&gt; sigma     1.63      0.22     1.27     2.11 1.00     2741     2599
#&gt; 
#&gt; Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential
#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
</section>
<section id="rescaling-problems" class="slide level2">
<h2>Rescaling, problems?</h2>
<p>We are using the default priors that are basically non-informative. What about setting appropriate or more informative priors?</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;                   prior     class coef group resp dpar nlpar lb ub       source
#&gt;                  (flat)         b                                       default
#&gt;                  (flat)         b mark                             (vectorized)
#&gt;  student_t(3, 3.9, 2.5) Intercept                                       default
#&gt;    student_t(3, 0, 2.5)     sigma                             0         default</code></pre>
</div>
</div>
</section>
<section id="rescaling-problems-1" class="slide level2">
<h2>Rescaling, problems?</h2>
<p>There are a couple of problems:</p>
<ul>
<li><code>Intercept</code> is the expected self-esteem score for people with 0 graduation mark (is that plausible?)</li>
<li><code>mark</code> is the expected increase in self-esteem for a unit increase in the graduation mark. (is that intepretable?)</li>
</ul>
<p>Assuming that we want to put priors, how do you choose the distribution and the parameters?</p>
</section>
<section id="rescaling-problems-2" class="slide level2">
<h2>Rescaling, problems?</h2>
<p>The first problem is that the <code>Intercept</code> is meaningless. Thus we can, for example, mean-center the <code>mark</code> variable. The slope is the same, we are only shifting the <code>x</code>. The intercept is different.</p>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-42-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="intercept-prior" class="slide level2">
<h2>Intercept prior</h2>
<p>Now the intercept is the expected self esteem value when <code>mark</code> is on average. Given that the values ranges from 0 to 20, we could put less probability of extreme values (for average marks, around 88) we could imagine also average value for self-esteem (around 10).</p>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-43-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="intercept-prior-centering" class="slide level2">
<h2>Intercept prior, centering</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb34-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">10</span>, <span class="dv">8</span>), <span class="at">class =</span> <span class="st">"Intercept"</span>)</span>
<span id="cb34-3"><a aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-4"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a aria-hidden="true" tabindex="-1"></a>priors</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Intercept ~ normal(10, 8)</code></pre>
</div>
</div>
</section>
<section id="slope-prior-rescaling" class="slide level2">
<h2>Slope prior, rescaling</h2>
<p>Then for the slope, probably there is too much granularity in the <code>mark</code> variable. 1 point increase is very tiny. To improve the model interpretation we can rescale the variable giving more weight to the unit increase.</p>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-45-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="slope-prior-rescaling-1" class="slide level2">
<h2>Slope prior, rescaling</h2>
<p>Now we have a more practical idea of size of the slope. We can use a very vague but not flat prior (the default) considering that 0 means no effect. Remember that now the slope is the increase in self-esteem for incrase of 10 points in the mark.</p>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-46-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="slope-prior-rescaling-2" class="slide level2">
<h2>Slope prior, rescaling</h2>
<p>The previus prior is very uninformative but is simply excluding impossible values. A slope of 10 means that increasing by 10 points would produce an increase that ranges the entire available scale.</p>
</section>
<section id="refitting-the-model" class="slide level2">
<h2>Refitting the model<sup>1</sup></h2>
<p>We can now refit the model using our priors and rescaling/centering</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  Family: gaussian 
#&gt;   Links: mu = identity; sigma = identity 
#&gt; Formula: se ~ mark10c 
#&gt;    Data: dat_mark (Number of observations: 30) 
#&gt;   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
#&gt;          total post-warmup draws = 4000
#&gt; 
#&gt; Regression Coefficients:
#&gt;           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
#&gt; Intercept     3.58      0.32     2.95     4.23 1.00     3172     2437
#&gt; mark10c       0.60      0.21     0.18     0.99 1.00     3775     2708
#&gt; 
#&gt; Further Distributional Parameters:
#&gt;       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
#&gt; sigma     1.75      0.24     1.35     2.31 1.00     3378     2792
#&gt; 
#&gt; Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential
#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<aside><ol class="aside-footnotes"><li id="fn1"><p>For the residual standard deviation, <code>brms</code> is already doing a good job with default priors, mainly escluding negative values.</p></li></ol></aside></section>
<section id="contrasts-coding" class="slide level2">
<h2>Contrasts coding</h2>
<p>Contrasts coding is a vast and difficult topic. The basic idea is that when you have categorical predictors, with or without interactions, the way you set the contrasts will impact the intepretation of model parameters (and the priors).</p>
<p>By default in R, categorical variables are coded using the so-called <strong>dummy coding</strong> or <strong>treatment coding</strong>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>), <span class="at">each =</span> <span class="dv">5</span>))</span>
<span id="cb37-2"><a aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] a a a a a b b b b b c c c c c
#&gt; Levels: a b c</code></pre>
</div>
</div>
</section>
<section id="contrasts-coding-1" class="slide level2">
<h2>Contrasts coding</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;   b c
#&gt; a 0 0
#&gt; b 1 0
#&gt; c 0 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(<span class="sc">~</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;    (Intercept) xb xc
#&gt; 1            1  0  0
#&gt; 2            1  0  0
#&gt; 3            1  0  0
#&gt; 4            1  0  0
#&gt; 5            1  0  0
#&gt; 6            1  1  0
#&gt; 7            1  1  0
#&gt; 8            1  1  0
#&gt; 9            1  1  0
#&gt; 10           1  1  0
#&gt; 11           1  0  1
#&gt; 12           1  0  1
#&gt; 13           1  0  1
#&gt; 14           1  0  1
#&gt; 15           1  0  1
#&gt; attr(,"assign")
#&gt; [1] 0 1 1
#&gt; attr(,"contrasts")
#&gt; attr(,"contrasts")$x
#&gt; [1] "contr.treatment"</code></pre>
</div>
</div>
</section>
<section id="contrasts-coding-2" class="slide level2">
<h2>Contrasts coding</h2>
<p>With a factor with <span class="math inline">\(p\)</span> levels, we need <span class="math inline">\(p - 1\)</span> variables representing contrasts. <strong>dummy-coding</strong> means that there will be a reference level (usually the first level) and <span class="math inline">\(p - 1\)</span> contrasts comparing the other levels with the first level (baseline).</p>
<p>An example with the <code>iris</code> dataset:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(iris<span class="sc">$</span>Species)</span>
<span id="cb43-2"><a aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "setosa"     "versicolor" "virginica"</span></span>
<span id="cb43-3"><a aria-hidden="true" tabindex="-1"></a>fit_dummy <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> Species, <span class="at">data =</span> iris)</span>
<span id="cb43-4"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_dummy)</span>
<span id="cb43-5"><a aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb43-6"><a aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb43-7"><a aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; lm(formula = Sepal.Length ~ Species, data = iris)</span></span>
<span id="cb43-8"><a aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb43-9"><a aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Residuals:</span></span>
<span id="cb43-10"><a aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span id="cb43-11"><a aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; -1.6880 -0.3285 -0.0060  0.3120  1.3120 </span></span>
<span id="cb43-12"><a aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb43-13"><a aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb43-14"><a aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                   Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb43-15"><a aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; (Intercept)         5.0060     0.0728  68.762  &lt; 2e-16 ***</span></span>
<span id="cb43-16"><a aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Speciesversicolor   0.9300     0.1030   9.033 8.77e-16 ***</span></span>
<span id="cb43-17"><a aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Speciesvirginica    1.5820     0.1030  15.366  &lt; 2e-16 ***</span></span>
<span id="cb43-18"><a aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb43-19"><a aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span id="cb43-20"><a aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb43-21"><a aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Residual standard error: 0.5148 on 147 degrees of freedom</span></span>
<span id="cb43-22"><a aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Multiple R-squared:  0.6187, Adjusted R-squared:  0.6135 </span></span>
<span id="cb43-23"><a aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; F-statistic: 119.3 on 2 and 147 DF,  p-value: &lt; 2.2e-16</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="contrasts-coding-3" class="slide level2">
<h2>Contrasts coding</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a aria-hidden="true" tabindex="-1"></a>vv <span class="ot">&lt;-</span> <span class="fu">split</span>(iris<span class="sc">$</span>Sepal.Length, iris<span class="sc">$</span>Species)</span>
<span id="cb44-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(vv<span class="sc">$</span>setosa)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 5.006</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(vv<span class="sc">$</span>versicolor) <span class="sc">-</span> <span class="fu">mean</span>(vv<span class="sc">$</span>setosa)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 0.93</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(vv<span class="sc">$</span>virginica) <span class="sc">-</span> <span class="fu">mean</span>(vv<span class="sc">$</span>setosa)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 1.582</code></pre>
</div>
</div>
</section>
<section id="contrasts-coding-4" class="slide level2">
<h2>Contrasts coding</h2>
<p>Another coding scheme could be the so called <strong>Successive Differences Contrast Coding</strong>. The idea is to compare level 2 with level 1, level 3 with level 2 and so on.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a aria-hidden="true" tabindex="-1"></a>iris<span class="sc">$</span>Species_sdif <span class="ot">&lt;-</span> iris<span class="sc">$</span>Species</span>
<span id="cb50-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(iris<span class="sc">$</span>Species_sdif) <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">contr.sdif</span>(<span class="dv">3</span>)</span>
<span id="cb50-3"><a aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(iris<span class="sc">$</span>Species_sdif)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;                   2-1        3-2
#&gt; setosa     -0.6666667 -0.3333333
#&gt; versicolor  0.3333333 -0.3333333
#&gt; virginica   0.3333333  0.6666667</code></pre>
</div>
</div>
</section>
<section id="contrasts-coding-5" class="slide level2">
<h2>Contrasts coding</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a aria-hidden="true" tabindex="-1"></a>fit_sdif <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> Species_sdif, <span class="at">data =</span> iris)</span>
<span id="cb52-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_sdif)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; lm(formula = Sepal.Length ~ Species_sdif, data = iris)
#&gt; 
#&gt; Residuals:
#&gt;     Min      1Q  Median      3Q     Max 
#&gt; -1.6880 -0.3285 -0.0060  0.3120  1.3120 
#&gt; 
#&gt; Coefficients:
#&gt;                 Estimate Std. Error t value Pr(&gt;|t|)    
#&gt; (Intercept)      5.84333    0.04203 139.020  &lt; 2e-16 ***
#&gt; Species_sdif2-1  0.93000    0.10296   9.033 8.77e-16 ***
#&gt; Species_sdif3-2  0.65200    0.10296   6.333 2.77e-09 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; Residual standard error: 0.5148 on 147 degrees of freedom
#&gt; Multiple R-squared:  0.6187, Adjusted R-squared:  0.6135 
#&gt; F-statistic: 119.3 on 2 and 147 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="more-on-contrasts-coding" class="slide level2">
<h2>More on contrasts coding</h2>
<p>There are few very useful papers about contrasts coding:</p>
<ul>
<li><span class="citation" data-cites="Schad2020-ht">Schad et al. (<a href="#/references" role="doc-biblioref" onclick="">2020</a>)</span>: comprehensive and (difficult) paper about contrasts coding</li>
<li><span class="citation" data-cites="Granziol2025-sy">Granziol et al. (<a href="#/references" role="doc-biblioref" onclick="">2025</a>)</span>: amazing work by our colleagues in Padova</li>
</ul>
</section></section>
<section>
<section id="hypothesis-testing-and-effect-size" class="title-slide slide level1 center">
<h1>Hypothesis testing and effect size</h1>

</section>
<section id="hypothesis-testing" class="slide level2">
<h2>Hypothesis testing</h2>
<p>The easiest way to test an hypothesis similarly to the frequentist framework is by checking if the null value of a certain test is contaned or not in the Credible Interval or the Highest Posterior Density Interval.</p>
<p>In the frequentist framework, the p value lower than <span class="math inline">\(\alpha\)</span> corresponds to a confidence interval to <span class="math inline">\(1 - \alpha\)</span> level that does not contains the null value (e.g., 0).</p>
</section>
<section id="brmshypothesis" class="slide level2">
<h2><code>brms::hypothesis()</code></h2>
<p>The <code>brms::hypothesis()</code> function is a very nice way to test hypotheses into a bayesian framework.</p>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-55-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="bayesian-r2-gelman2019-hp" class="slide level2">
<h2>Bayesian <span class="math inline">\(R^2\)</span> <span class="citation" data-cites="Gelman2019-hp">(<a href="#/references" role="doc-biblioref" onclick="">Gelman et al. 2019</a>)</span></h2>
<p><span class="citation" data-cites="Gelman2019-hp">Gelman et al. (<a href="#/references" role="doc-biblioref" onclick="">2019</a>)</span> explained a generalization of the common <span class="math inline">\(R^2\)</span> to be applied for Bayesian Generalized Linear Models.</p>
<p><span class="math display">\[
\text{Bayesian } R^2_s =
\frac{
\mathrm{Var}_{n=1}^{N}\left( y_n^{\text{pred}, s} \right)
}{
\mathrm{Var}_{n=1}^{N}\left( y_n^{\text{pred}, s} \right) + \mathrm{Var}_{\text{res}}^s
}
\]</span></p>
<p>There are few important points:</p>
<ul>
<li>This works for any GLM (unlike the usual <span class="math inline">\(R^2\)</span>)</li>
<li>Different models on the same dataset cannot be compared <!-- TODO rivedi questo --> https://avehtari.github.io/bayes_R2/bayes_R2.html</li>
</ul>
</section>
<section id="extracting-posteriors" class="slide level2">
<h2>Extracting posteriors</h2>
<p>https://www.andrewheiss.com/blog/2022/09/26/guide-visualizing-types-posteriors/ https://www.andrewheiss.com/blog/2022/09/26/guide-visualizing-types-posteriors/#complete-cheat-sheet</p>
</section>
<section id="bayes-factor" class="slide level2">
<h2>Bayes Factor</h2>
<p>As an example we can start with the classical coin-flip experiment. We need to guess if a coin is fair or not. Firstly let’s formalize our prior beliefs in probabilistic terms:</p>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-56-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="bayes-factor-1" class="slide level2">
<h2>Bayes Factor</h2>
<p>Now we collect data and we observe <span class="math inline">\(x = 40\)</span> tails out of <span class="math inline">\(k = 50\)</span> trials thus <span class="math inline">\(\hat{\pi} = 0.8\)</span> and compute the <em>likelihood</em>:</p>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-57-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="bayes-factor-2" class="slide level2">
<h2>Bayes Factor</h2>
<p>Finally we combine, using the Bayes rule, <strong>prior</strong> and <strong>likelihood</strong> to obtain the <strong>posterior</strong> distribution:</p>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-58-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="bayes-factor-3" class="slide level2">
<h2>Bayes Factor</h2>
<p>The <strong>Bayes Factor</strong> (BF) — also called the <strong>likelihood ratio</strong>, for obvious reasons — is a measure of the relative support that the evidence provides for two competing hypotheses, <span class="math inline">\(H_0\)</span> and <span class="math inline">\(H_1\)</span> (~ <span class="math inline">\(\pi\)</span> in our previous example). It plays a key role in the following <em>odds form</em> of Bayes’s theorem.</p>
<p><span class="math display">\[
\frac{p(H_0|D)}{p(H_1|D)} = \frac{p(D|H_0)}{p(D|H_1)} \times \frac{p(H_0)}{p(H_1)}
\]</span></p>
<p>The ratio of the priors <span class="math inline">\(\frac{p(H_0)}{p(H_1)}\)</span> is called the <strong>prior odds</strong> of the hypotheses; and, the ratio of the poosteriors <span class="math inline">\(\frac{p(H_0| D)}{p(H_1 | D)}\)</span> is called the <strong>posterior odds</strong> of the hypotheses. Thus, the above (odds form) of Bayes’s Theorem can be paraphrased as follows</p>
<p><span class="math display">\[
\text{posterior odds} = \text{Bayes Factor} \times \text{prior odds}
\]</span></p>
</section>
<section id="calculating-the-bayes-factor-using-the-sdr" class="slide level2">
<h2>Calculating the Bayes Factor using the SDR</h2>
<p>Calculating the BF can be challenging in some situations. The Savage-Dickey density ratio (SDR) is a convenient shortcut to calculate the Bayes Factor <span class="citation" data-cites="Wagenmakers2010-fj">(<a href="#/references" role="doc-biblioref" onclick="">Wagenmakers et al. 2010</a>)</span>. The idea is that the ratio of the prior and posterior density distribution for hypothesis <span class="math inline">\(H_1\)</span> is an estimate of the Bayes factor calculated in the standard way.</p>
<p><span class="math display">\[
BF_{01} = \frac{p(D|H_0)}{p(D|H_1)} \approx \frac{p(\pi = x|D, H_1)}{p(\pi = x | H_1)}
\]</span></p>
<p>Where <span class="math inline">\(\pi\)</span> is the parameter of interest and <span class="math inline">\(x\)</span> is the null value under <span class="math inline">\(H_0\)</span> (e.g., 0). and <span class="math inline">\(D\)</span> are the data.</p>
</section>
<section id="calculating-the-bayes-factor-using-the-sdr-1" class="slide level2">
<h2>Calculating the Bayes Factor using the SDR</h2>
<p>Following the previous example <span class="math inline">\(H_0: \pi = 0.5\)</span>. Under <span class="math inline">\(H_1\)</span> we use a vague prior by setting <span class="math inline">\(\pi \sim Beta(1, 1)\)</span>.</p>
<p>Say we flipped the coin 20 times and we found that <span class="math inline">\(\hat \pi = 0.75\)</span>.</p>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-59-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="calculating-the-bayes-factor-using-the-sdr-2" class="slide level2">
<h2>Calculating the Bayes Factor using the SDR</h2>
<p>The ratio between the two black dots is the Bayes Factor.</p>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-60-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="bayes-factor-in-brms" class="slide level2">
<h2>Bayes Factor in <code>brms</code></h2>
<p>https://vuorre.com/posts/2017-03-21-bayes-factors-with-brms/ https://easystats.github.io/bayestestR/reference/bayesfactor_parameters.html#:~:text=For%20the%20computation%20of%20Bayes,flat%20priors%20the%20null%20is</p>
</section>
<section id="be-careful-with-the-bayes-factor" class="slide level2">
<h2>Be careful with the Bayes Factor</h2>
<p>The Bayes Factor computed with <code>hypothesis()</code> or in general the SDR method is highly sensitive to the priors. See also the <code>bayestestR</code> <a href="https://easystats.github.io/bayestestR/reference/bayesfactor_parameters.html#setting-the-correct-prior">documentation</a>. In general:</p>
<ul>
<li>The Bayes Factor requires informative or at least non-flat priors. Remember that in <code>brms</code> the default prior is flat</li>
<li>As the prior scale (e.g., standard deviation) increase, the Bayes Factor tends to suggest evidence for the null hypothesis, even when the null hypothesis is false</li>
</ul>
<p>This is called <a href="https://en.wikipedia.org/wiki/Lindley%27s_paradox">Lindley’s paradox</a>. <span class="citation" data-cites="Wagenmakers2023-ll">(see <a href="#/references" role="doc-biblioref" onclick="">Wagenmakers and Ly 2023</a>)</span>.</p>
</section>
<section id="lindleys-paradox-a-simulation" class="slide level2">
<h2>Lindley’s paradox, a simulation</h2>
<p>We can just simulate a t-test (or equivalently a parameter of a model) and run the Bayesian model with different prior distribution scale.</p>
<p>For a t-test we are focused on the prior for the (standardized) difference between the means. We can set a prior centered on 0 with different scale.</p>
<p>Here I’m using the <code>BayesFactor</code> package just because is faster for simple model if we are interested in the Bayes Factor pointnull (the same as <code>brms::hypothesis(x, "b = 0")</code>).</p>
</section>
<section id="lindleys-paradox-a-simulation-1" class="slide level2">
<h2>Lindley’s paradox, a simulation</h2>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-61-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="prior-sensitivity-check" class="slide level2">
<h2>Prior Sensitivity Check</h2>
<p>Given the sensitivity of Bayesian models to the prior, especially when informative is always a good idea to check the actual impact of priors. Not only for Bayes Factors but also for the posterior distributions.</p>
<ul>
<li>Run your model with the prior that are more plausible for you</li>
<li>Run the same model with priors that are more and less informative</li>
<li>Check the impact of the prior on your posterior distributions and conclusions</li>
</ul>
</section>
<section id="prior-predictive-check" class="slide level2">
<h2>Prior Predictive Check</h2>
<p>The prior predictive check is an important process when setting the priors in a regression model. The basic idea is that the posterior distribution is the combination between priors and likelihood (i.e., the data). If we remove likelihood from the equation, we obtain a “posterior” only using information in the prior.</p>
<p>The advantage is that we can simulate data to check if our priors are reasonable according to our model, phenomenon, etc.</p>
<p>In <code>brms</code> there is an argument called <code>sample_prior</code> that can be set to <code>"only"</code> to fit a model ignoring the data:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">brm</span>(</span>
<span id="cb54-2"><a aria-hidden="true" tabindex="-1"></a>  y <span class="sc">~</span> x,</span>
<span id="cb54-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat, <span class="co"># not used</span></span>
<span id="cb54-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_prior =</span> <span class="st">"only"</span></span>
<span id="cb54-5"><a aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prior-predictive-check-1" class="slide level2">
<h2>Prior predictive check</h2>
<p>Assuming to have a simple model with a continous and categorical predictor:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;            y          x g
#&gt; 1  0.7812706  0.6207567 0
#&gt; 2 -1.1101886  0.0356414 0
#&gt; 3  0.3243795  0.7731545 0
#&gt; 4  1.8243161  1.2724891 0
#&gt; 5  0.6446891  0.3709754 0
#&gt; 6  1.0857640 -0.1628543 0</code></pre>
</div>
</div>
</section>
<section id="prior-predictive-check-2" class="slide level2">
<h2>Prior predictive check</h2>
<p>We know that <code>x</code> and <code>y</code> are standandardized thus we can think about the effect <code>g</code> in terms of Cohen’s <span class="math inline">\(d\)</span> and the effect of <code>x</code> in terms of units of standard deviations. Let’s set some priors for <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">get_prior</span>(y <span class="sc">~</span> x <span class="sc">+</span> g, <span class="at">data =</span> dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;                 prior     class coef group resp dpar nlpar lb ub       source
#&gt;                (flat)         b                                       default
#&gt;                (flat)         b    g                             (vectorized)
#&gt;                (flat)         b    x                             (vectorized)
#&gt;  student_t(3, 0, 2.5) Intercept                                       default
#&gt;  student_t(3, 0, 2.5)     sigma                             0         default</code></pre>
</div>
</div>
</section>
<section id="prior-predictive-check-3" class="slide level2">
<h2>Prior predictive check</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb58-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> <span class="st">"b"</span>, <span class="at">coef =</span> <span class="st">"g"</span>),</span>
<span id="cb58-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="at">class =</span> <span class="st">"b"</span>, <span class="at">coef =</span> <span class="st">"x"</span>)</span>
<span id="cb58-4"><a aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-5"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-6"><a aria-hidden="true" tabindex="-1"></a>fit_prior <span class="ot">&lt;-</span> <span class="fu">brm</span>(y <span class="sc">~</span> x <span class="sc">+</span> g, <span class="at">data =</span> dat, <span class="at">sample_prior =</span> <span class="st">"only"</span>, <span class="at">prior =</span> priors, <span class="at">file =</span> <span class="fu">here</span>(<span class="st">"slides"</span>, <span class="st">"objects"</span>, <span class="st">"fit_prior.rds"</span>))</span>
<span id="cb58-7"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_prior)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  Family: gaussian 
#&gt;   Links: mu = identity; sigma = identity 
#&gt; Formula: y ~ x + g 
#&gt;    Data: dat (Number of observations: 50) 
#&gt;   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
#&gt;          total post-warmup draws = 4000
#&gt; 
#&gt; Regression Coefficients:
#&gt;           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
#&gt; Intercept     0.30      5.00    -8.67     8.82 1.00     2585     1590
#&gt; x             0.03      2.04    -4.00     3.96 1.00     2844     2449
#&gt; g            -0.02      1.00    -2.05     1.91 1.00     3089     2397
#&gt; 
#&gt; Further Distributional Parameters:
#&gt;       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
#&gt; sigma     2.79      3.83     0.08    10.10 1.00     2647     1440
#&gt; 
#&gt; Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential
#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
</section>
<section id="prior-predictive-check-4" class="slide level2">
<h2>Prior predictive check</h2>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-66-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="extracting-posterior-distributions" class="slide level2">
<h2>Extracting Posterior Distributions</h2>
<p>When running a model with <code>lm</code> and <code>glm</code>, all the required information is included into the summary of the model. For each parameter we have the point estimate, standard error, confidence interval, etc.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a aria-hidden="true" tabindex="-1"></a>fit_lm_example <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> Petal.Width <span class="sc">+</span> Species, <span class="at">data =</span> iris)</span>
<span id="cb60-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_lm_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; lm(formula = Sepal.Length ~ Petal.Width + Species, data = iris)
#&gt; 
#&gt; Residuals:
#&gt;     Min      1Q  Median      3Q     Max 
#&gt; -1.3891 -0.3043 -0.0472  0.2528  1.3358 
#&gt; 
#&gt; Coefficients:
#&gt;                   Estimate Std. Error t value Pr(&gt;|t|)    
#&gt; (Intercept)        4.78044    0.08308  57.543  &lt; 2e-16 ***
#&gt; Petal.Width        0.91690    0.19386   4.730 5.25e-06 ***
#&gt; Speciesversicolor -0.06025    0.23041  -0.262    0.794    
#&gt; Speciesvirginica  -0.05009    0.35823  -0.140    0.889    
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; Residual standard error: 0.481 on 146 degrees of freedom
#&gt; Multiple R-squared:  0.6694, Adjusted R-squared:  0.6626 
#&gt; F-statistic: 98.53 on 3 and 146 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="extracting-posterior-distributions-1" class="slide level2">
<h2>Extracting Posterior Distributions</h2>
<p>With Bayesian models we have posterior distributions that can be summarised in different ways. There are several methods and packages to work with posteriors:</p>
</section>
<section id="extracting-posterior-distributions-2" class="slide level2">
<h2>Extracting Posterior Distributions</h2>
<p>With the <code>as_draws_df</code> we can extract all the samples from the posterior distribution:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A draws_df: 6 iterations, 1 chains, and 6 variables
#&gt;   b_Intercept b_mark sigma Intercept lprior lp__
#&gt; 1        -9.6   0.15   1.5       4.3   -3.4  -59
#&gt; 2       -10.2   0.16   1.4       4.1   -3.3  -59
#&gt; 3        -9.0   0.15   1.5       4.6   -3.4  -62
#&gt; 4        -9.0   0.15   1.4       4.3   -3.4  -60
#&gt; 5        -8.7   0.14   1.5       3.8   -3.4  -59
#&gt; 6        -8.0   0.13   1.4       3.7   -3.3  -60
#&gt; # ... hidden reserved variables {'.chain', '.iteration', '.draw'}</code></pre>
</div>
</div>
</section>
<section id="extracting-posterior-distributions-3" class="slide level2">
<h2>Extracting Posterior Distributions</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(fit_mark) <span class="sc">|&gt;</span> </span>
<span id="cb63-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"b"</span>), sigma) <span class="sc">|&gt;</span> </span>
<span id="cb63-3"><a aria-hidden="true" tabindex="-1"></a>  posterior<span class="sc">::</span><span class="fu">summarise_draws</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 3 × 10
#&gt;   variable     mean median     sd    mad       q5    q95  rhat ess_bulk ess_tail
#&gt;   &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
#&gt; 1 b_Interce… -7.96  -7.98  2.10   2.05   -11.5    -4.49   1.00    3049.    2798.
#&gt; 2 b_mark      0.133  0.133 0.0230 0.0227   0.0954  0.172  1.00    3064.    2776.
#&gt; 3 sigma       1.63   1.60  0.217  0.211    1.32    2.03   1.00    2706.    2588.</code></pre>
</div>
</div>
</section>
<section id="hpdi-with-bayestestr" class="slide level2">
<h2>HPDI with <code>bayestestR</code></h2>
<p>The <code>bayestestR</code> contains a lot of functions to do inference and post-processing on <code>brms</code> (and also other) models:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a aria-hidden="true" tabindex="-1"></a>bayestestR<span class="sc">::</span><span class="fu">hdi</span>(fit_mark)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Highest Density Interval
#&gt; 
#&gt; Parameter   |         95% HDI
#&gt; -----------------------------
#&gt; (Intercept) | [-12.24, -3.92]
#&gt; mark        | [  0.09,  0.18]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bayestestR<span class="sc">::</span><span class="fu">hdi</span>(fit_mark))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-71-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="the-broom-package" class="slide level2">
<h2>The <code>broom</code> package</h2>
<p>The <code>broom.mixed</code> package automatically provide the <code>summary()</code> into a data.frame format:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom.mixed)</span>
<span id="cb68-2"><a aria-hidden="true" tabindex="-1"></a>broom.mixed<span class="sc">::</span><span class="fu">tidy</span>(fit_mark)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 3 × 8
#&gt;   effect   component group    term         estimate std.error conf.low conf.high
#&gt;   &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
#&gt; 1 fixed    cond      &lt;NA&gt;     (Intercept)    -7.96     2.10   -12.2       -3.85 
#&gt; 2 fixed    cond      &lt;NA&gt;     mark            0.133    0.0230   0.0882     0.179
#&gt; 3 ran_pars cond      Residual sd__Observa…    1.63     0.217    1.27       2.11</code></pre>
</div>
</div>
</section>
<section id="more-on-bayestestr" class="slide level2">
<h2>More on <code>bayestestR</code></h2>
<p>This is a really amazing package, have a look at the <code>Features</code> section because contains functions and explanations about different ways of summarizing the posterior distribution.</p>
</section>
<section id="plotting-effects" class="slide level2">
<h2>Plotting effects</h2>
<p>The <code>brms</code> package contains some functions to plot the effects, such as the <code>conditional_effects()</code> function.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">conditional_effects</span>(fit_mark)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-73-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section></section>
<section>
<section id="factorial-design-example" class="title-slide slide level1 center">
<h1>Factorial design example</h1>

</section>
<section id="factorial-design-example-1" class="slide level2">
<h2>Factorial design example</h2>
<p>We can make a very easy example with a 3x2 factorial design. Let’s load some data:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a aria-hidden="true" tabindex="-1"></a>dat_factorial <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"clean"</span>, <span class="st">"factorial.rds"</span>))</span>
<span id="cb71-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat_factorial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;     Group Anxiety         DV
#&gt; 1 Control     Low 0.82075674
#&gt; 2 Control     Low 0.23564140
#&gt; 3 Control     Low 0.97315448
#&gt; 4 Control     Low 1.47248909
#&gt; 5 Control     Low 0.57097543
#&gt; 6 Control     Low 0.03714566</code></pre>
</div>
</div>
</section>
<section id="factorial-design-example-2" class="slide level2">
<h2>Factorial design example</h2>
<p>We can fit our model with interaction:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a aria-hidden="true" tabindex="-1"></a>fit_factorial <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb73-2"><a aria-hidden="true" tabindex="-1"></a>  DV <span class="sc">~</span> Group <span class="sc">*</span> Anxiety,</span>
<span id="cb73-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="fu">here</span>(<span class="st">"slides"</span>, <span class="st">"objects"</span>, <span class="st">"fit_factorial.rds"</span>),</span>
<span id="cb73-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat_factorial</span>
<span id="cb73-5"><a aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="factorial-design-example-3" class="slide level2">
<h2>Factorial design example</h2>
<p>We can create the grid of values:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb74-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="at">Group =</span> <span class="fu">unique</span>(dat_factorial<span class="sc">$</span>Group),</span>
<span id="cb74-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="at">Anxiety =</span> <span class="fu">unique</span>(dat_factorial<span class="sc">$</span>Anxiety)</span>
<span id="cb74-4"><a aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb74-5"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(grid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;          Group Anxiety
#&gt; 1      Control     Low
#&gt; 2 Experimental     Low
#&gt; 3      Control  Medium
#&gt; 4 Experimental  Medium
#&gt; 5      Control    High
#&gt; 6 Experimental    High</code></pre>
</div>
</div>
</section>
<section id="factorial-design-example-4" class="slide level2">
<h2>Factorial design example</h2>
<p>We can calculate the cell-means for the Group, averaging over the level of the other factor i.e.&nbsp;the main effect. We can use the <a href="https://mjskay.github.io/tidybayes/"><code>tidybayes</code></a> package.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb76-2"><a aria-hidden="true" tabindex="-1"></a>grid <span class="sc">|&gt;</span> </span>
<span id="cb76-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_epred_draws</span>(<span class="at">object =</span> fit_factorial) <span class="sc">|&gt;</span> </span>
<span id="cb76-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Group, .draw) <span class="sc">|&gt;</span> </span>
<span id="cb76-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">y =</span> <span class="fu">mean</span>(.epred)) <span class="sc">|&gt;</span> </span>
<span id="cb76-6"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Group) <span class="sc">|&gt;</span> </span>
<span id="cb76-7"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">median_hdci</span>(y)) <span class="sc">|&gt;</span> </span>
<span id="cb76-8"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 2 × 7
#&gt;   Group            y    ymin  ymax .width .point .interval
#&gt;   &lt;fct&gt;        &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
#&gt; 1 Control      0.185 -0.0671 0.446   0.95 median hdci     
#&gt; 2 Experimental 0.128 -0.125  0.395   0.95 median hdci</code></pre>
</div>
</div>
</section>
<section id="factorial-design-example-5" class="slide level2">
<h2>Factorial design example</h2>
<p>Same but using <code>emmeans</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb78-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">emmeans</span>(fit_factorial, <span class="sc">~</span> Group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  Group        emmean lower.HPD upper.HPD
#&gt;  Control       0.185   -0.0638     0.448
#&gt;  Experimental  0.128   -0.1315     0.386
#&gt; 
#&gt; Results are averaged over the levels of: Anxiety 
#&gt; Point estimate displayed: median 
#&gt; HPD interval probability: 0.95</code></pre>
</div>
</div>
</section></section>
<section>
<section id="logistic-regression-example" class="title-slide slide level1 center">
<h1>Logistic regression example</h1>

</section>
<section id="logistic-regression-example-1" class="slide level2">
<h2>Logistic regression example</h2>
<p>For an overview of the logistic regression we can refer to this <a href="https://stat-teaching.github.io/GLMphd/slides/02-binomial-glm/02-binomial-glm.html#/title-slide">material</a>.</p>
</section>
<section id="logistic-regression-using-brms" class="slide level2">
<h2>Logistic regression using <code>brms</code></h2>
<p>We can fit the same model of the previous slides using the <code>teddy</code> data.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a aria-hidden="true" tabindex="-1"></a>teddy <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(<span class="st">"data/clean/teddy_child.csv"</span>))</span>
<span id="cb80-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(teddy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;   ID Children Fam_status        Education Occupation Age Smoking_status
#&gt; 1  1        1    Married      High school  Full-time  42             No
#&gt; 2  2        1    Married      High school  Full-time  42             No
#&gt; 3  3        1    Married      High school  Full-time  44             No
#&gt; 4  4        2    Married      High school  Full-time  48             No
#&gt; 5  5        3    Married Degree or higher  Full-time  39            Yes
#&gt; 6  6        2    Married Degree or higher  Full-time  38      Ex-smoker
#&gt;   Alcool_status Depression_pp Parental_stress Alabama_involvment MSPSS_total
#&gt; 1            No            No              75                 36    6.500000
#&gt; 2            No            No              51                 41    5.500000
#&gt; 3            No            No              76                 42    1.416667
#&gt; 4            No            No              88                 39    1.083333
#&gt; 5           Yes            No              67                 35    7.000000
#&gt; 6            No            No              61                 36    3.333333
#&gt;   LTE Partner_cohesion Family_cohesion
#&gt; 1   5         4.333333        2.916667
#&gt; 2   5         4.166667        3.000000
#&gt; 3   4         3.000000        2.500000
#&gt; 4   4         2.166667        2.666667
#&gt; 5   2         4.166667        2.666667
#&gt; 6   0         3.000000        2.583333</code></pre>
</div>
</div>
</section>
<section id="logistic-regression-using-brms-1" class="slide level2">
<h2>Logistic regression using <code>brms</code></h2>
<p>Let’s convert the response variable <code>Depression_pp</code> to a binary variable:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a aria-hidden="true" tabindex="-1"></a>teddy<span class="sc">$</span>Depression_pp01 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(teddy<span class="sc">$</span>Depression_pp <span class="sc">==</span> <span class="st">"Yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb82-2"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a aria-hidden="true" tabindex="-1"></a>fit_teddy <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb82-4"><a aria-hidden="true" tabindex="-1"></a>  Depression_pp01 <span class="sc">~</span> Parental_stress,</span>
<span id="cb82-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> teddy,</span>
<span id="cb82-6"><a aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">bernoulli</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb82-7"><a aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="fu">here</span>(<span class="st">"slides"</span>, <span class="st">"objects"</span>, <span class="st">"fit_teddy.rds"</span>)</span>
<span id="cb82-8"><a aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="logistic-regression-using-brms-2" class="slide level2">
<h2>Logistic regression using <code>brms</code></h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_teddy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  Family: bernoulli 
#&gt;   Links: mu = logit 
#&gt; Formula: Depression_pp01 ~ Parental_stress 
#&gt;    Data: teddy (Number of observations: 379) 
#&gt;   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
#&gt;          total post-warmup draws = 4000
#&gt; 
#&gt; Regression Coefficients:
#&gt;                 Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
#&gt; Intercept          -4.34      0.70    -5.71    -3.01 1.00     2570     2509
#&gt; Parental_stress     0.04      0.01     0.02     0.06 1.00     2937     2486
#&gt; 
#&gt; Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential
#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
</section>
<section id="logistic-regression-using-brms-3" class="slide level2">
<h2>Logistic regression using <code>brms</code></h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit_teddy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-82-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="logistic-regression-using-brms-4" class="slide level2">
<h2>Logistic regression using <code>brms</code></h2>
<p>The posterior draws, by default, are always on the linear predictor scale. For the Gaussian model this is not relevant, but here everything is in logit.s</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A draws_df: 6 iterations, 1 chains, and 5 variables
#&gt;   b_Intercept b_Parental_stress Intercept lprior lp__
#&gt; 1        -4.9             0.045      -2.1   -2.3 -138
#&gt; 2        -5.2             0.050      -2.1   -2.3 -139
#&gt; 3        -3.6             0.024      -2.1   -2.3 -139
#&gt; 4        -4.0             0.031      -2.1   -2.3 -138
#&gt; 5        -3.9             0.029      -2.0   -2.3 -138
#&gt; 6        -5.7             0.057      -2.0   -2.3 -141
#&gt; # ... hidden reserved variables {'.chain', '.iteration', '.draw'}</code></pre>
</div>
</div>
</section>
<section id="logistic-regression-using-brms-5" class="slide level2">
<h2>Logistic regression using <code>brms</code></h2>
<p>The intercept is the logit of the probability of success when all predictors are zero.</p>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-84-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="logistic-regression-using-brms-6" class="slide level2">
<h2>Logistic regression using <code>brms</code></h2>
<p>The <code>Parental_stress</code> coefficient is the increase in the log-odds of success for a unit increase in the Parental stress.</p>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-85-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="logistic-regression-using-brms-7" class="slide level2">
<h2>Logistic regression using <code>brms</code></h2>
<p>When plotting the effects with <code>conditional_effects()</code> we are working on the probability space:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">conditional_effects</span>(fit_teddy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-86-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="logistic-regression-using-brms-8" class="slide level2">
<h2>Logistic regression using <code>brms</code></h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb88-2"><a aria-hidden="true" tabindex="-1"></a>pp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Parental_stress =</span> <span class="fu">c</span>(<span class="dv">40</span>, <span class="dv">80</span>, <span class="dv">120</span>))</span>
<span id="cb88-3"><a aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fit_teddy, <span class="at">newdata =</span> pp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;      Estimate Est.Error Q2.5 Q97.5
#&gt; [1,]  0.05800 0.2337727    0     1
#&gt; [2,]  0.19525 0.3964426    0     1
#&gt; [3,]  0.49100 0.4999815    0     1</code></pre>
</div>
</div>
</section>
<section id="logistic-regression-using-brms-9" class="slide level2">
<h2>Logistic regression using <code>brms</code></h2>

<img data-src="bayesian-glm_files/figure-revealjs/unnamed-chunk-88-1.svg" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="bayesian-workflow" class="slide level2">
<h2>Bayesian Workflow</h2>
<ul>
<li>Nice paper about the Bayesian Workflow: <a href="https://sites.stat.columbia.edu/gelman/research/unpublished/Bayesian_Workflow_article.pdf">https://sites.stat.columbia.edu/gelman/research/unpublished/Bayesian_Workflow_article.pdf</a></li>
</ul>
</section>
<section id="references" class="slide level2 refs smaller scrollable">
<h2>References</h2>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Gelman2019-hp" class="csl-entry" role="listitem">
Gelman, Andrew, Ben Goodrich, Jonah Gabry, and Aki Vehtari. 2019. <span>“R-Squared for Bayesian Regression Models.”</span> <em>The American Statistician</em> 73: 307–9. <a href="https://doi.org/10.1080/00031305.2018.1549100">https://doi.org/10.1080/00031305.2018.1549100</a>.
</div>
<div id="ref-Granziol2025-sy" class="csl-entry" role="listitem">
Granziol, Umberto, Maximilian Rabe, Marcello Gallucci, Andrea Spoto, and Giulio Vidotto. 2025. <span>“Not Another Post Hoc Paper: A New Look at Contrast Analysis and Planned Comparisons.”</span> <em>Advances in Methods and Practices in Psychological Science</em> 8 (January). <a href="https://doi.org/10.1177/25152459241293110">https://doi.org/10.1177/25152459241293110</a>.
</div>
<div id="ref-Schad2020-ht" class="csl-entry" role="listitem">
Schad, Daniel J, Shravan Vasishth, Sven Hohenstein, and Reinhold Kliegl. 2020. <span>“How to Capitalize on a Priori Contrasts in Linear (Mixed) Models: A Tutorial.”</span> <em>Journal of Memory and Language</em> 110 (February): 104038. <a href="https://doi.org/10.1016/j.jml.2019.104038">https://doi.org/10.1016/j.jml.2019.104038</a>.
</div>
<div id="ref-Wagenmakers2010-fj" class="csl-entry" role="listitem">
Wagenmakers, Eric-Jan, Tom Lodewyckx, Himanshu Kuriyal, and Raoul Grasman. 2010. <span>“Bayesian Hypothesis Testing for Psychologists: A Tutorial on the Savage–Dickey Method.”</span> <em>Cognitive Psychology</em> 60 (May): 158–89. <a href="https://doi.org/10.1016/j.cogpsych.2009.12.001">https://doi.org/10.1016/j.cogpsych.2009.12.001</a>.
</div>
<div id="ref-Wagenmakers2023-ll" class="csl-entry" role="listitem">
Wagenmakers, Eric-Jan, and Alexander Ly. 2023. <span>“History and Nature of the Jeffreys-Lindley Paradox.”</span> <em>Archive for History of Exact Sciences</em> 77: 25–72. <a href="https://doi.org/10.1007/s00407-022-00298-3">https://doi.org/10.1007/s00407-022-00298-3</a>.
</div>
</div>
</section></section>

    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>